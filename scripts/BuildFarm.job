#!/bin/bash

cat << EOF > ${WORKSPACE}/BUILD-INFO.txt
Format-Version: 0.5

Files-Pattern: *
License-Type: open
EOF

export runtests=true

export CONFIG_SHELL="/bin/bash"
shared="/home/buildslave/workspace/shared/"
abe_dir="${WORKSPACE}/abe"
user_snapshots="${WORKSPACE}/snapshots"
snapshots_ref="${shared}/snapshots"

rm -fr ${WORKSPACE}/_build
mkdir -p ${WORKSPACE}/_build

cd ${WORKSPACE}/_build
$CONFIG_SHELL ${abe_dir}/configure --with-local-snapshots=${user_snapshots} --with-git-reference-dir=${shared}/snapshots
$CONFIG_SHELL -x ${abe_dir}/jenkins.sh ${release}

# force a failure of abe has build problems.
if test $? -gt 0; then
  exit 1
fi
