# This is a list of other components need to build this component
depends="gmp mpfr mpc linux binutils"

# This is the latest version of this toolchain component
installs="gcc"

# This is a file that gets installed that is used to determine if the toolchain
# component is already installed.
latest="linaro-4.8-2013.08"

# If yes, only static linking will be used
static_link=yes

# This is a list of default flags always supplied to configure
default_configure_flags="--with-pkgversion=${USER}  --with-bugurl=https://bugs.launchpad.net/gcc-linaro --with-mpc=${local_builds}/${host} --with-mpfr=${local_builds}/${host} --with-gmp=${local_builds}/${host} --with-gnu-as --with-gnu-ld --with-system-zlib --enable-languages=c"

# --with-as=${local_builds}/bin/${target}-as --with-ld=${local_builds}/bin/${target}-ld 

# Disable the Graphite loop optimizer for now
default_configure_flags="${default_configure_flags} --with-cloog=no --with-ppl=no --with-isl=no"
# default_configure_flags="${default_configure_flags} --with-ppl=${local_builds} --with-cloog=${local_builds} --with-isl=${local_builds}"

# Libgomp is for shared memory parallel programming, so we disable it
default_configure_flags="${default_configure_flags} --disable-libgomp"

default_configure_flags="${default_configure_flags} --disable-nls"

# multilibs are enabled by default
#default_configure_flags="${default_configure_flags} --enable-multilib"

# enable multiarch
default_configure_flags="${default_configure_flags} --enable-multiarch"

# libssp does stack protection
#default_configure_flags="${default_configure_flags} --enable-libssp"

# C99 is the latest standard, and has improved numerics support
# http://en.wikipedia.org/wiki/C99
default_configure_flags="${default_configure_flags} --enable-c99"

#default_configure_flags="${default_configure_flags} --disable-libsanitizer"

# Used by fortran
# http://gcc.gnu.org/onlinedocs/libquadmath/
# default_configure_flags="${default_configure_flags} --disable-libquadmath"

# Transactional Memory, used for threading
# http://gcc.gnu.org/wiki/TransactionalMemory
#default_configure_flags="${default_configure_flags} --disable-libitm"

# Libatomic is a synchronization library	     
# http://www.hpl.hp.com/research/linux/atomic_ops/
#default_configure_flags="${default_configure_flags} --disable-libatomic"

# For a cross build, we need the target as part of the name for to find the correct.
# assembler and linker. We also disable bootstrapping for cross builds
if test x"${build}" != x"${target}"; then
   # These next libraries suffer from the dreaded GCC_NO_EXECUTABLES macros for Autoconf,
   # which prevents these from being able to be cross configured.
   gcc_no_executables="--disable-libssp --disable-libquadmath"
   # stage1_flags are used to build the initial C compiler, which is used to compile
   # the C library. We disable most everything, as the second GCC build will be
   # able to use the C library built with the first GCC build.
   stage1_flags=" --disable-threads  --without-headers --with-newlib --disable-libmudflap --disable-bootstrap --disable-decimal-float --disable-libatomic --disable-libsanitizer --disable-plugins --disable-libitm ${gcc_no_executables} --enable-languages=c"
   stage2_flags="--disable-bootstrap ${gcc_no_executables} CFLAGS_FOR_TARGET=-static --with-build-sysroot=${sysroots} --enable-languages=c,c++"
   # Add platform specific flags
    case ${target} in
	arm*-none-linux-gnueabi)
	    default_configure_flags="${default_configure_flags} --with-arch=armv7-a --with-fpu=vfpv3-d16 --with-float=softfp --with-thumb"
	    clibrary=eglibc
	    need_qemu=yes
	    ;;
	arm*-linux-gnueabihf)
	    default_configure_flags="${default_configure_flags} --with-arch=armv7-a --with-fpu=vfpv3-d16 --with-float=hard --with-thumb"
	    clibrary=eglibc
	    need_qemu=yes
	    ;;
	    # bare metal targets don't support threads.
	arm*-eabi)
	    default_configure_flags="${default_configure_flags} --with-newlib --disable-threads --disable-libmudflap"
	    clibrary=newlib
	    need_qemu=no
	    ;;
	 aarch64*-*-elf)
	    default_configure_flags="${default_configure_flags} --enable-long-long --disable-libmudflap"
	    clibrary=newlib
	    need_qemu=no
	    ;;
	aarch64*-linux-gnu)
	    default_configure_flags="${default_configure_flags} --enable-long-long --disable-libmudflap"
	    clibrary=eglibc
	    need_qemu=no
	    ;;
	*)
	    clibrary=eglibc
	    need_qemu=no
	    ;;
    esac
   
    if test x"${clibrary}" = x"newlib"; then
        # bare metal targets don't support threads.
	default_configure_flags="${default_configure_flags} --with-newlib --disable-threads"
        if test x"${newlib_version}" = x; then
   	    libc_version="newlib-`grep ^latest= ${topdir}/config/newlib.conf | cut -d '\"' -f 2`"
	else
	    libc_version="newlib-${newlib_version}"
	fi
    else
        if test x"${eglibc_version}" = x; then
	    libc_version="eglibc-`grep ^latest= ${topdir}/config/eglibc.conf | cut -d '\"' -f 2`"
	else
	    libc_version="eglibc-${eglibc_version}"
	fi
    fi
    tag="sysroot-${libc_version}-${target}"
    default_configure_flags="${default_configure_flags} --with-sysroot=/opt/linaro/${tag}"

# native builds are easy
  else
    default_configure_flags="${default_configure_flags} --enable-linker-build-id --without-included-gettext --enable-threads=posix --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --disable-libitm --enable-plugin --with-system-zlib --enable-objc-gc --enable-multiarch --disable-sjlj-exceptions"
    case ${target} in
	arm*-none-linux-gnueabi)
	    default_configure_flags="${default_configure_flags} --with-arch=armv7-a --with-fpu=vfpv3-d16 --with-float=softfp --with-thumb "
	    ;;
	arm*-linux-gnueabihf)
	    default_configure_flags="${default_configure_flags} --with-arch=armv7-a --with-fpu=vfpv3-d16 --with-float=hard --with-thumb"
	    ;;
	arm*-eabi | aarch64*-*-elf)
	    default_configure_flags="${default_configure_flags} --with-newlib"
	    ;;
	aarch64*-linux-gnu)
	    #default_configure_flags="${default_configure_flags}"
	    ;;
	x86-pc-linux-gnu)
           default_configure_flags="${default_configure_flags} --enable-linker-build-id --without-included-gettext --enable-threads=posix --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-object --disable-libitm --enable-plugin --with-system-zlib --enable-objc-gc --enable-multiarch --disable-sjlj-exceptions"
	    ;;
	x86_64*-linux-gnu)
	    ;;
	*)
	    ;;
    esac
  	stage2_flags=""
fi	 

# This is a list of default flags always supplied to "make check".
# --xml produces XML files suitable for importing into a MySQL
runtest_flags=""

