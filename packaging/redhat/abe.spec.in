# These variables are set by ABE in lib/make.sh:build_rpm() at runtime.
%global srcdir
%global abe_version
%global rtag
# Note, respin must be integer. This defaults to 0, and can redefined
# by uncommenting the global variable, or on the command line to rpmbuild
# like this: --define "respin X".
# %global respin 1
# Disable stripping of binaries, it's already been done.
# %global __strip /bin/true
# Disable other commands that we don't need as this spec file doesn't compile anything.
%global __os_install_post %{nil}
%global __check_files %{nil}
# Disable trying to run elfdefs.
%global __elf_provides %{nil}
%global __elf_requires %{nil}
# Set the default install path for these files.
%global installdir /opt/linaro
Prefix: %{installdir}

Summary: ABE - Automated Build Enironment
Name: abe
Version: %{abe_version}
Release: %{?respin:0}%{?dist}
License: GPLv3+ and GPLv3+ with exceptions
Group: Development/Languages
Source0: https://releases.linaro.org/latest/toolchain
URL: http://www.linaro.org
BuildArch: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-%{rtag}-root-%(%{__id_u} -n)/opt

Requires: bash, flex, bison, autogen, autoconf, automake, libtool, makeinfo, git, wget
#Suggests: dejagnu, ccache, lsb-build-cc, lsb-build-c++

%description
This package contains the Linaro ABE tool for building cross and native toolchains.

%package linaro
Summary: Linaro Toolchain Working Group GCC release
Group: System Environment/Libraries
Autoreq: false

%description linaro
This package contains the Linaro ABE tool, which is used to build, validate, and package
the GNU toolchain.

%prep
    mkdir -p %{_builddir}/%{rtag}
    rsync --exclude=autom4te.cache --exclude=.git --exclude=.gitreview --exclude=.gitignore --copy-links -avr %{srcdir}/* %{_builddir}/%{rtag}
    rm -fr %{_builddir}/${path}/{validate.sh,tcwgweb.sh,sum2junit.sh}

%build

%install
rm -rf %{buildroot}
mkdir -p %{_builddir}/%{rtag} %{buildroot}%{installdir}/%{rtag}
rsync -avr %{_builddir}/%{rtag} %{buildroot}%{installdir}/
mkdir -p %{buildroot}/etc/profile.d/
echo "PATH=/opt/linaro/${path}:$PATH" > %{buildroot}/etc/profile.d/linaro-abe.sh
echo "export PATH" >> %{buildroot}/etc/profile.d/linaro-abe.sh

%check

%clean
rm -rf %{buildroot}

%files linaro
%defattr(-,root,root,-)
/etc/*
%{installdir}/*

%changelog
* Sun Sep 6 2015 Rob Savoye <rob.savoye@linaro.org>
- Initial creation
